<html>
	<head>
<link type="text/css" href="css/blitzer/jquery-ui-1.8.16.custom.css" rel="stylesheet" />	
<script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.16.custom.min.js"></script>
<script language="javascript" src="./js/jquery.svg.min.js"></script>
<link rel="stylesheet" href="css/blueprint/screen.css" type="text/css" media="screen, projection">
<link rel="stylesheet" href="css/blueprint/print.css" type="text/css" media="print"> 
<!--[if lt IE 8]>
<link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection">
<![endif]-->
<!--script language="javascript" src="http://revolunet.github.com/VLCcontrols/src/jquery-vlc.js"></script-->
<!--link rel="stylesheet" type="text/css" href="http://revolunet.github.com/VLCcontrols/src/styles.css" /-->

<!--script language="javascript">
	$(document).ready(function() {
		var player = VLCobject.embedPlayer('vlc1', 400, 300);
		player.play('test.avi');
	});
</script-->

	</head>
<body>
<!--BODY BODY BODY BODY BODY BODY BODY BODY BODY BODY BODY BODY -->

<div id="tabs" style="position:relative;width:auto;height:750px;" align=center>
	<ul>
		<li><a>HEADER</a></li>
		<li><a href="#oct_tab">OCT</a></li>
		<li><a href="#config_tab" id="config_fold">CONFIG</a></li>
	</ul>
	<div id="oct_tab" style="position:relative;width:auto;height:700px;">
		<div id="oct_div" style="float:left;width:790px;height:700px;">
			<!--embed type="application/x-vlc-plugin" 
			name="player"
			pluginspage="http://www.videolan.org" 
			version="VideoLAN.VLCPlugin.2"  
			target="fifo"></embed-->
		</div>
		<div style="float:left;width:100px;height:700px;" align=center > 
		</div>
		<div style="float:left;width:30px;height:700px;" align=center > 
			<div id="slider" style="width:10px;height:700px;" class="ui-slider ui-slider-vertical" > </div>
		</div>
		<div id="rightd" style="float:left;width:auto;height:700px;" align=center>
			<div style="float:clear;height:360px;width:300px;">
				<input id="line_density" type="text" value="fe">
			</div>
			<div style="float:clear;height:20px;width:300px;">
				<div style="float:left;width:100%;">
					<button id="scan" style="float:left;width:100%;">scan</button>
				</div>
				<div style="float:left;width:100%;" id="scantype">	
					<input id="2D" type="radio" name="ScanType"/><label style="width:49%;" for="2D">Line</label>
					<input id="3D" type="radio" name="ScanType"/><label style="width:49%;" for="3D">Area</label>
				</div>
			</div>
			<div id="sketch" style="height:200px;width:300px;">
			</div>
		</div>
	</div>
	<div id="config_tab"></div>
</div>
<div id="footer" align=center>
	<span class="ui-icon ui-icon-info"></span>F11 - Toggle fullscreen
</div>
<!--BODY BODY BODY BODY BODY BODY BODY BODY BODY BODY BODY BODY -->
<script>
outline= null;
start = null;
scan_settings = null;
var drawNodes = []; 
$('#2D').click(function switchTo2D(event){
	    get_outline = function(x1,y1,x2,y2,settings){
	    	return sketchpad.line(x1,y1,x2,y2,settings);
	    };
		update_outline = function(outline,settings){
			scan_settings = settings;
			scan_settings.mode = '2D'
			return sketchpad.change(outline, settings);
		};
});

$('#3D').click(function (event){
	get_outline = function(x1,y1,x2,y2,settings){
		return sketchpad.rect(x1,y1,x2,y2,settings);
	};
	update_outline = function(outline,settings){
		var left = Math.min(settings.x1, settings.x2);
		var top = Math.min(settings.y1, settings.y2);
		var right = Math.max(settings.x1, settings.x2);
		var bottom = Math.max(settings.y1, settings.y2);
		scan_settings = settings;
		scan_settings.mode = '3D'
		return sketchpad.change(outline, {
			fill:"none",
			x: left, 
			y: top,
			width: right - left,
			height: bottom - top,
			stroke: settings.stroke,
			strokeWidth: settings.strokeWidth,
			strokeDashArray: settings.strokeDashArray 
		});
	};
});
$("#scantype").buttonset();
$("#tabs").tabs().select('oct_tab');
$("button").button();
$("#scan").click(function(event){
	$.get("../scan",scan_settings,function(data){
		alert(data);
	});
});

$("#config_fold").click(function(){
	$.getJSON("../config",function(data){
		co =data;
		traverse(data,visitor);
	});
})

function traverse(data,visit){
	for(var key in data){
		if(typeof data[key]=== "object"){
			traverse(data[key],visitor);
		}else{
			visitor(key,data);	
		}
	}
}

function visitor(key,data){
	$("#config_tab").append("<br>"+key+"<input type='text' value='"+data[key]+"'/>")
}

$("#oct_div").svg({
    onLoad: function (svg) {
        oct_image = svg;
        var image = svg.rect(0, 0, "100%", "100%", {
            id: "oct",
            fill: "white",
			stroke:"black",
        });
    },
});


$('#sketch').svg({
    onLoad: function (svg) {
        sketchpad = svg;
        var surface = svg.rect(0, 0, "100%", "100%", {
            id: 'surface',
            fill: 'white',
			stroke:'black',
        });
        $(surface).mousedown(startDrag).mousemove(dragging).mouseup(endDrag);
    }
});

$("#slider").slider({
	orientation: "vertical",
	min:0,
	max:100,
	value:50,
}); 

function startDrag(evt){
	x=evt.offsetX ;//- $("#sketch").offset().left;
	y=evt.offsetY; 
	start = {
		X: evt.offsetX,
		Y: evt.offsetY
	};
    event.preventDefault();
	if(outline){
		sketchpad.remove(outline)
	}
	outline = null;
}

function dragging(event) {
    if (!start) {
        return;
    }
    if (!outline) {
       outline = get_outline(0, 0, 0, 0, {
			stroke: 'black',
            strokeWidth: 1,
            strokeDashArray: '2,2',
        });
        $(outline).mouseup(endDrag);
    }
    update_outline(outline, {
        x1: start.X,
        y1: start.Y,
        x2: event.offsetX,
        y2: event.offsetY,
		stroke: 'black',
		strokeWidth: 1,
		strokeDashArray: '2,2',
    });
    event.preventDefault();
}

function endDrag(event) {
    if (!start) {
        return;
    }
    update_outline(outline, {
        x1: start.X,
        y1: start.Y,
        x2: event.offsetX,
        y2: event.offsetY,
	    stroke:'black',
            strokeWidth: 1,
            strokeDashArray: null,
    });
    //drawShape(start.X, start.Y, event.offsetX , event.offsetY );
    start = null;
    event.preventDefault();
}

function drawShape(x1, y1, x2, y2) {
       outline = get_outline(x1, y1, x2, y2, {
			stroke:'black',
            strokeWidth: 1,
        });
}
</script>
</body>
</html>

